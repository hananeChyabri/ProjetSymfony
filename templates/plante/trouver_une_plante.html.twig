{% extends "base.html.twig" %}
{% block stylesheets %}
	{{parent()}}
	{{ encore_entry_link_tags('findPlante') }}
{% endblock %}

{% block javascripts %}
	{{parent()}}
	{{ encore_entry_script_tags('findPlante') }}
{% endblock %}

{% block body %}
	<main>
		<!-- Menu de recherche -->
		<section class="filtres">
			<h3>Filtres</h3>


			<div class="accordion" id="accordionPanelsStayOpenExample">
				{{ form_start(form, {'attr': {'id': 'filtre-form-plante'}}) }}
				<div class="accordion-item">
					<h2 class="accordion-header" id="panelsStayOpen-headingOne">
						<button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true" aria-controls="panelsStayOpen-collapseOne">
							Exposition
						</button>
					</h2>
					<div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show" aria-labelledby="panelsStayOpen-headingOne">
						<div class="accordion-body">

							{% for choice, value in form.exposition %}
								<div class="custom-radio">
									{{ form_widget(value, { 'attr': {'class': 'custom-control-input'} }) }}
									<label class="custom-control-label" for="{{ value.vars.id }}">{{ value.vars.value }}</label>
								</div>
							{% endfor %}


						</div>
					</div>
				</div>
				<div class="accordion-item">
					<h2 class="accordion-header" id="panelsStayOpen-headingTwo">
						<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="false" aria-controls="panelsStayOpen-collapseTwo">
							Besoin eau
						</button>
					</h2>
					<div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingTwo">
						<div class="accordion-body">

							{% for choice, value in form.besoinEau %}
								<div class="custom-radio">
									{{ form_widget(value, { 'attr': {'class': 'custom-control-input'} }) }}
									<label class="custom-control-label" for="{{ value.vars.id }}">{{ value.vars.value }}</label>
								</div>
							{% endfor %}

						</div>
					</div>
				</div>

					<div class="accordion-item">
					<h2 class="accordion-header" id="panelsStayOpen-headingThree">
						<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseThree" aria-expanded="false" aria-controls="panelsStayOpen-collapseTwo">
							Besoin eau
						</button>
					</h2>
					<div id="panelsStayOpen-collapseThree" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingThree">
						<div class="accordion-body">

							{% for choice, value in form.lieuCultive %}
								<div class="custom-radio">
									{{ form_widget(value, { 'attr': {'class': 'custom-control-input'} }) }}
									<label class="custom-control-label" for="{{ value.vars.id }}">{{ value.vars.value }}</label>
								</div>
							{% endfor %}

						</div>
					</div>
				</div>
				{{ form_end(form) }}
			</div>


			
	</section>

	<!-- Fiches produits -->
	<section
		class="fiches">
		<!-- Code ajouté -->

		{% for plante in listePlantes %}
			<article>

				{% for image in plante.images %}

					{# <img src="{{ asset('images/plante1.jpg') }}" alt="Description de l'image"> #}
					<img src="{{ asset(image.url) }}" alt="Description de l'image">
				{% endfor %}
				<h2>{{ plante.nom }}<h2></article>


				{% endfor %}


			</section>
		</main>


		<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.5.1/axios.min.js" integrity="sha512-emSwuKiMyYedRwflbZB2ghzX8Cw8fmNVgZ6yQNNXXagFzFOaQmbvQ1vmDkddHjm5AITcBIZfC7k4ShQSjgPAmQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
		<script>


			// on obtient le formulaire pour
const form = document.getElementById('filtre-form-plante');

// on detectera tous les inputs du form, peu importe quel fitre on change
form.addEventListener('change', function (event) {
event.preventDefault();
// obtenir le div pour afficher les résultats


console.log("appel recherche...");


axios({
url: '{{ path ("maPlante") }}',
method: 'POST',
headers: {
'Content-Type': 'multipart/form-data'
},
data: new FormData(document.getElementById("filtre-form-plante"))
}).then(function (response) {


let sectionPlante = document.querySelector(".fiches");

// parcourir l'array d'objets reçu (car le JSON a été déjà parsé par AXIOS)
let arrayPlantes = response.data;

console.log(arrayPlantes);


sectionPlante.innerHTML = "";


arrayPlantes.forEach(function (plante) { // manipuler le DOM. Ex: vider un div et le remplir avec les résultats
console.log(plante);
const planteElement = document.createElement("article");

// nom de la plante
const nomPlante = document.createElement("P");
nomPlante.innerText = plante.nom + " " + plante.exposition+"   "+plante.besoinEau+"   "+plante.lieuCultive;

const imagePlante = document.createElement("img");
// image de la plante
plante.images.forEach(function (url) {
imagePlante.src = "/" + url;
});


sectionPlante.appendChild(planteElement);

planteElement.appendChild(imagePlante);
planteElement.appendChild(nomPlante);


});


}).catch(error => {
console.error(error);
});
});
		</script>
	{% endblock %}
